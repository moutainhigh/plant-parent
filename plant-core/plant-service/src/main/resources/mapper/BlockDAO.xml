<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.moguying.plant.core.dao.block.BlockDAO">
  <resultMap id="BaseResultMap" type="com.moguying.plant.core.entity.block.Block">
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="number" jdbcType="VARCHAR" property="number" />
    <result column="seed_type" jdbcType="INTEGER" property="seedType" />
    <result column="level" jdbcType="INTEGER" property="level" />
    <result column="total_amount" jdbcType="DECIMAL" property="totalAmount" />
    <result column="per_price" jdbcType="DECIMAL" property="perPrice" />
    <result column="grow_days" jdbcType="INTEGER" property="growDays" />
    <result column="interest_rates" jdbcType="INTEGER" property="interestRates" />
    <result column="total_count" jdbcType="INTEGER" property="totalCount" />
    <result column="left_count" jdbcType="INTEGER" property="leftCount" />
    <result column="has_count" jdbcType="INTEGER" property="hasCount" />
    <result column="is_show" jdbcType="BIT" property="isShow" />
    <result column="state" jdbcType="INTEGER" property="state" />
    <result column="add_time" jdbcType="TIMESTAMP" property="addTime" />
    <result column="is_delete" jdbcType="BIT" property="isDelete" />
    <result column="max_plant" jdbcType="INTEGER" property="maxPlant" />
    <result column="min_plant" jdbcType="INTEGER" property="minPlant" />
    <result column="pic_url" jdbcType="VARCHAR" property="picUrl" />
    <result column="thumb_pic_url" jdbcType="VARCHAR" property="thumbPicUrl" />

  </resultMap>
  
  <resultMap id="ResultMapWithTypeName" type="com.moguying.plant.core.entity.block.Block" extends="BaseResultMap">
    <result column="seed_type_name" property="seedTypeName" jdbcType="VARCHAR"/>
  </resultMap>

  <resultMap id="ResultMapForHomeList" type="com.moguying.plant.core.entity.common.vo.HomeBlock">
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="number" jdbcType="VARCHAR" property="number" />
    <result column="seed_type_name" jdbcType="VARCHAR" property="seedTypeName" />
    <result column="pic_url" jdbcType="VARCHAR" property="picUrl" />

  </resultMap>

  <sql id="Base_Column_List">
    id, `number`, seed_type, `level`, total_amount, per_price, total_count, left_count, interest_rates,
    has_count, is_show, `state`, add_time, is_delete,grow_days,max_plant,min_plant,pic_url,thumb_pic_url
  </sql>

  <update id="deleteById" parameterType="java.lang.Integer">
    update plant_block set is_delete = 1
    where id = #{id,jdbcType=INTEGER}
  </update>

  <insert id="insert" parameterType="com.moguying.plant.core.entity.block.Block" useGeneratedKeys="true" keyProperty="id">
    insert into plant_block
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="id != null">
        id,
      </if>
      <if test="number != null">
        `number`,
      </if>
      <if test="seedType != null">
        seed_type,
      </if>
      <if test="level != null">
        `level`,
      </if>
      <if test="totalAmount != null">
        total_amount,
      </if>
      <if test="perPrice != null">
        per_price,
      </if>
      <if test="totalCount != null">
        total_count,
      </if>
      <if test="leftCount != null">
        left_count,
      </if>
      <if test="hasCount != null">
        has_count,
      </if>
      <if test="isShow != null">
        is_show,
      </if>
      <if test="state != null">
        `state`,
      </if>
      <if test="addTime != null">
        add_time,
      </if>
      <if test="isDelete != null">
        is_delete,
      </if>
      <if test="growDays != null">
        grow_days,
      </if>
      <if test="maxPlant != null">
        max_plant,
      </if>
      <if test="minPlant != null">
        min_plant,
      </if>
      <if test="interestRates != null">
        interest_rates,
      </if>
      <if test="picUrl != null">
        pic_url,
      </if>
      <if test="thumbPicUrl != null">
        thumb_pic_url,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="id != null">
        #{id,jdbcType=INTEGER},
      </if>
      <if test="number != null">
        #{number,jdbcType=VARCHAR},
      </if>
      <if test="seedType != null">
        #{seedType,jdbcType=INTEGER},
      </if>
      <if test="level != null">
        #{level,jdbcType=INTEGER},
      </if>
      <if test="totalAmount != null">
        #{totalAmount,jdbcType=DECIMAL},
      </if>
      <if test="perPrice != null">
        #{perPrice,jdbcType=DECIMAL},
      </if>
      <if test="totalCount != null">
        #{totalCount,jdbcType=INTEGER},
      </if>
      <if test="leftCount != null">
        #{leftCount,jdbcType=INTEGER},
      </if>
      <if test="hasCount != null">
        #{hasCount,jdbcType=INTEGER},
      </if>
      <if test="isShow != null">
        #{isShow,jdbcType=BIT},
      </if>
      <if test="state != null">
        #{state,jdbcType=INTEGER},
      </if>
      <if test="addTime != null">
        #{addTime,jdbcType=TIMESTAMP},
      </if>
      <if test="isDelete != null">
        #{isDelete,jdbcType=BIT},
      </if>
      <if test="growDays != null">
        #{growDays,jdbcType=BIT},
      </if>
      <if test="maxPlant != null">
        #{maxPlant,jdbcType=BIT},
      </if>
      <if test="minPlant != null">
        #{minPlant,jdbcType=BIT},
      </if>
      <if test="interestRates != null">
        #{interestRates,jdbcType=DECIMAL},
      </if>
      <if test="picUrl != null">
        #{picUrl,jdbcType=VARCHAR},
      </if>
      <if test="thumbPicUrl != null">
        #{thumbPicUrl,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateById" parameterType="com.moguying.plant.core.entity.block.Block">
    update plant_block
    <set>
      <if test="number != null">
        `number` = #{number,jdbcType=VARCHAR},
      </if>
      <if test="seedType != null">
        seed_type = #{seedType,jdbcType=INTEGER},
      </if>
      <if test="level != null">
        `level` = #{level,jdbcType=INTEGER},
      </if>
      <if test="totalAmount != null">
        total_amount = #{totalAmount,jdbcType=DECIMAL},
      </if>
      <if test="perPrice != null">
        per_price = #{perPrice,jdbcType=DECIMAL},
      </if>
      <if test="totalCount != null">
        total_count = #{totalCount,jdbcType=INTEGER},
      </if>
      <if test="leftCount != null">
        left_count = #{leftCount,jdbcType=INTEGER},
      </if>
      <if test="hasCount != null">
        has_count = #{hasCount,jdbcType=INTEGER},
      </if>
      <if test="isShow != null">
        is_show = #{isShow,jdbcType=BIT},
      </if>
      <if test="state != null">
        `state` = #{state,jdbcType=INTEGER},
      </if>
      <if test="addTime != null">
        add_time = #{addTime,jdbcType=TIMESTAMP},
      </if>
      <if test="isDelete != null">
        is_delete = #{isDelete,jdbcType=BIT},
      </if>
      <if test="growDays != null">
        grow_days = #{growDays,jdbcType=BIT},
      </if>
      <if test="maxPlant != null">
        max_plant = #{maxPlant,jdbcType=BIT},
      </if>
      <if test="minPlant != null">
        min_plant = #{minPlant,jdbcType=BIT},
      </if>
      <if test="interestRates != null">
        interest_rates = #{interestRates,jdbcType=DECIMAL},
      </if>
      <if test="picUrl != null">
        pic_url = #{picUrl,jdbcType=VARCHAR},
      </if>
      <if test="thumbPicUrl != null">
        thumb_pic_url = #{thumbPicUrl,jdbcType=VARCHAR},
      </if>
    </set>
    where id = #{id,jdbcType=INTEGER}
  </update>

  <select id="selectSelective" resultMap="ResultMapWithTypeName">
    select t1.id, `number`, seed_type, `level`, total_amount, t1.per_price, total_count, left_count,t1.interest_rates,t1.pic_url,
    t1.thumb_pic_url,has_count, is_show, `state`, add_time, t1.grow_days,t1.max_plant,t1.min_plant,
    t2.class_name as seed_type_name from plant_block t1
    left join plant_seed_type t2 on t1.seed_type = t2.id
    <where>
      <if test="number != null">
        number = #{number}
      </if>
      <if test="seedType !=null">
        AND seed_type = #{seedType}
      </if>
      <if test="level != null ">
        AND level = #{level}
      </if>
      <if test="isShow != null">
        AND is_show = #{isShow}
      </if>
      <if test="state != null">
        AND state = #{state}
      </if>
      AND t1.is_delete = 0
    </where>
    order by add_time desc
  </select>
  
  
  <select id="selectById" resultMap="ResultMapWithTypeName">
    select t1.id, `number`, seed_type, `level`, total_amount, t1.per_price, total_count, left_count,t1.interest_rates,
    t1.pic_url,t1.thumb_pic_url,has_count, is_show, `state`, add_time, t1.grow_days,t1.max_plant,t1.min_plant,
    t2.class_name as seed_type_name from plant_block t1
    left join plant_seed_type t2 on t1.seed_type = t2.id
    where t1.id = #{id}
  </select>
  

  <select id="selectBlockByNumber" resultMap="BaseResultMap">
    select <include refid="Base_Column_List"/> from plant_block
    where number = #{number} AND is_show = 1
  </select>


  <select id="blockIsFree" parameterType="java.lang.Integer" resultType="java.lang.Integer">
    select count(*) from plant_reap t1
    left join plant_seed_order t2 on t1.order_id = t2.id
    left join plant_block t3 on t1.block_id = t3.id
    where t1.state <![CDATA[ < 2 ]]> and t1.block_id = #{id}
  </select>

  <select id="selectBlockListForHome" resultMap="ResultMapForHomeList">
    select t1.id,number,t2.class_name as seed_type_name ,t1.pic_url from plant_block t1
    left join plant_seed_type t2 on t1.seed_type = t2.id
    where t1.is_show = 1 and t1.is_delete = 0 and t1.state = 1
  </select>

  <select id="selectBySeedType" resultMap="BaseResultMap">
     select <include refid="Base_Column_List"/> from plant_block
     where seed_type = #{seedType}
  </select>

</mapper>